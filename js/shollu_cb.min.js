!function(t,e,a,i){"use strict";var n="shollu_cb",r="1.0.1",o={source:function(t,e){},onSelect:function(t){},onChange:function(t){},style:"bs3",menu_type:"normal",emptyMessage:"<center><b>No results were found</b></center>",page:1,rows:50,idField:"id",textField:"name",queryParams:{},item_cls:"",addition:{},list:{},remote:!1},l=function(e,a){function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,a="x"===t?e:3&e|8;return a.toString(16)})}function l(){return"bs3"==O.style?t('<div id="'+O.guid+'" class="shollu_cb-container"><div class="input-group"><input type="hidden"><div class="input-group-btn"><span data-guid="'+O.guid+'" class="btn btn-default shollu_cb dropdown-toggle" data-dropdown="dropdown"><span class="caret" /></span></div></div></div>'):void 0}function s(){return t('<ul class="typeahead-long shollu_cb dropdown-menu dropdown-menu-right" />')}function c(){if(!j.data("init-shollu_cb")){j.data("init-shollu_cb",!0),j.before(P),S.before(j),S.attr("name",j.attr("name")),j.removeAttr("name"),O.disable=j.attr("disabled")===i?!1:j.attr("disabled")?!0:!1,u(O.disable),O.remote||Object.keys(O.list).length>0&&(t.each(O.list,function(t){var e=O.list[t][O.idField];O.list[t][O.textField];H[e]=O.list[t]}),O.rowData=H);var e=j.val();y(e)}return this}function d(){j.data("init-shollu_cb")&&(j.data("init-shollu_cb",!1),j.insertBefore(P),j.attr("name",S.attr("name")),j.val(S.val()),P.remove(),T(!1))}function u(t){j.prop("disabled",t),q.attr("disabled",t),O.disable=t,T(t?!1:!0)}function f(){var e=t.extend({},j.position(),{height:j[0].offsetHeight});M.insertAfter(j).css({top:e.top+e.height,left:e.left}).show(),O.shown=!0}function h(){M.hide(),t(".dropdown-menu").off("mousedown",function(t){"UL"==t.target.tagName}),O.shown=!1}function v(){N=!1,O.escape||(x(),O.selected||x(),!A&&O.shown&&setTimeout(function(){h(),O.page=1},200))}function g(){O.shown&&h(),O.disable||(O.shown?(h(),j.focus()):p())}function p(){var e=j.attr("data-"+O.idField),a=j.attr("data-"+O.textField),i=j.val();if(i!=a&&(j.attr("value","").attr("data-"+O.idField,"").attr("data-"+O.textField,""),S.val("").trigger("change"),O.onChange.call(this,{}),e=""),O.remote){var n={page:O.page,rows:O.rows};e?n[O.idField]=e:i&&(n.q=i),t.each(O.queryParams,function(t,e){n[t]=e}),setTimeout(function(){t.getJSON(O.url,n,function(t){var e=t.data;Object.keys(e).length>0&&b(e)})},100)}else b(O.list)}function x(){var t=(j.attr("data-"+O.idField),j.attr("data-"+O.textField)),e=j.val();e!=t&&(j.attr("value","").attr("data-"+O.idField,"").attr("data-"+O.textField,"").val("").trigger("change"),S.val("").trigger("change"),O.onSelect.call(this,{}));var a=j.attr("value"),n=M.find(".active").data(O.idField),r=M.find(".active").data(O.textField);return n===i?h():(n!==a&&(j.attr("value",n).attr("data-"+O.idField,n).attr("data-"+O.textField,r).val(r).trigger("change"),S.val(n).trigger("change"),O.onSelect.call(this,O.rowData[n])),O.selected=!0,h())}function b(e){var a=[],i=e,n=j.attr("data-"+O.idField),r=j.val().toLowerCase();if(1==O.page&&M.empty(),Object.keys(O.addition).length>0){var o=O.addition[O.idField],l=O.addition[O.textField],s=O.item_cls?'class="'+O.item_cls+'" ':"";a.push(t("<li "+s+"data-"+O.idField+'="'+o+'" data-'+O.textField+'="'+l+'"><a>'+l+"</a></li>")),H[o]=O.addition}O.remote&&(i=e.rows,Q=Math.ceil(e.total/O.rows)),Object.keys(i).length>0?(t.each(i,function(e){var o=i[e][O.idField],l=i[e][O.textField],s=O.item_cls?'class="'+O.item_cls+'" ':"";if(n&&n==o){var c="active ";s=s?s+c:'class="'+c+'"'}if(r&&r==l.toLowerCase()){var c="active ";s=s?s+c:'class="'+c+'"'}a.push(t("<li "+s+"data-"+O.idField+'="'+o+'" data-'+O.textField+'="'+l+'"><a>'+l.replace(r,"<b>"+r+"</b>")+"</a></li>")),H[o]=i[e]}),M.append(a)):M.append('<span style="color:#999;">'+O.emptyMessage+"</span>"),O.rowData=H,f(),j.focus()}function m(){var t=M.find(".active");if(t.length){var e=t.position().top,a=e+t.height(),i=M.scrollTop(),n=M.height();a>n?M.scrollTop(i+a-n):0>e&&M.scrollTop(i+e)}}function w(t){var e;return t=t===i?O.idField:t,(e=j.attr("value")===i?"":""==j.attr("value")?"":j.attr("value"))&&j.attr("value")?(e=O.rowData[j.attr("value")][t])===i?!1:e:void 0}function y(e){if(j.data("init-shollu_cb")!==!1){if(!e||0>e)return j.attr("value","").attr("data-"+O.idField,"").attr("data-"+O.textField,"").val("").trigger("change"),S.val("").trigger("change"),void O.onChange.call(this,{});if(O.remote)setTimeout(function(){t.getJSON(O.url,{id:e},function(t){var e=t.data.rows[0];if("undefined"!=typeof e){var a=e[O.idField],i=e[O.textField];j.attr("value",a).attr("data-"+O.idField,a).attr("data-"+O.textField,i).val(i).trigger("change"),S.val(a).trigger("change"),O.selected=!0,H[a]=e,O.rowData=H,O.onChange.call(this,O.rowData[a])}})},100);else if(Object.keys(O.list).length>0&&O.rowData[e]!==i){var a=O.rowData[e][O.idField],n=O.rowData[e][O.textField];j.attr("value",a).attr("data-"+O.idField,a).attr("data-"+O.textField,n).val(n).trigger("change"),S.val(a).trigger("change"),O.selected=!0,O.onChange.call(this,O.rowData[a])}}}function F(e){j.focus(),e.stopPropagation(),e.preventDefault();var a=(e.currentTarget.scrollTop+t(e.currentTarget).height())/e.currentTarget.scrollHeight*100;if(a>90&&!L&&O.page<Q&&(L=!0,O.page++,O.remote)){var i=j.val(),n={q:i,page:O.page,rows:O.rows};t.each(O.queryParams,function(t,e){n[t]=e}),setTimeout(function(){t.getJSON(O.url,n,function(t){var e=t.data;Object.keys(e).length>0&&b(e),L=!1})},100)}}function k(){var e=M.find(".active").removeClass("active"),a=e.next();a.length||(a=t(M.find("li")[0])),a.addClass("active")}function _(){var t=M.find(".active").removeClass("active"),e=t.prev();e.length||(e=M.find("li").last()),e.addClass("active")}function C(t){if(O.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),_(),m();break;case 40:t.preventDefault(),k(),m()}t.stopPropagation()}}function D(t){switch(t.keyCode){case 40:O.shown||g();break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!O.shown)return;x();break;case 27:if(!O.shown)return;O.escape=!0,h();break;default:p()}t.stopPropagation(),t.preventDefault()}function T(e){e?(j.on("focus",function(){N=!0}).on("blur",v).on("keypress",function(t){J||C(t)}).on("keydown",function(e){J=~t.inArray(e.keyCode,[40,38,9,13,27]),C(e)}).on("keyup",D).on("dblclick",g),M.on("click",function(t){j.focus(),t.stopPropagation(),t.preventDefault(),x()}).on("mouseenter","li",function(e){A=!0,M.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")}).on("mouseleave",function(){A=!1}).scroll(F),q.on("click",g)):(j.off("blur focusout focus keydown keyup keypress dblclick"),M.off("click mouseenter mouseleave scroll"),q.off("click"))}var O=a;O.guid=o();var j=t(e),P=l(),S=P.find("input[type=hidden]"),q=P.find("span.shollu_cb.dropdown-toggle"),M=s(),N=!1,A=!1,J={},L=!1,H={},Q=1;this.name=n,this.version=r+" ("+O.guid+")",this.o=O,this.destroy=function(){d()},this.getValue=function(t){return w(t)},this.setValue=function(t){y(t)},this.disable=function(t){u(t)},this.init=function(){c()},c()};t.fn.shollu_cb=function(e){var a=t(this),i=a.data("shollu_cb");if("string"==typeof e){if(!i)return this;if(i[e])return t.isFunction(i[e])?i[e].apply(i,Array.prototype.slice.call(arguments,1)):i[e];t.error("Method "+e+" does not exist on jQuery.shollu_cb")}return this.each(function(){i?(i.o=t.extend(i.o,e),a.data("shollu_cb",i)):a.data("shollu_cb",new l(this,t.extend({},o,e)))})}}(jQuery);